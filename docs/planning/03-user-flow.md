# User Flow (사용자 흐름도)

> Mermaid 플로우차트로 핵심 기능의 주요 여정을 표현합니다.

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 설치 없이 브라우저에서 바로 즐기는 추억의 고전 테트리스 |
| 2 | 페르소나 | 전 연령 가족 단위 (점심시간/짧은 휴식 시간에 플레이) |
| 3 | 핵심 기능 | FEAT-1: 테트리스 기본 플레이 |
| 4 | 성공 지표 (노스스타) | 평균 세션 지속 시간 10분 이상 |
| 5 | 입력 지표 | 일일 활성 사용자(DAU), 스테이지 10 클리어 비율 |
| 6 | 비기능 요구 | 60fps 유지, 반응형(PC+모바일), 정확한 조작감 |
| 7 | Out-of-scope | 소셜 로그인, 리더보드 공유, 멀티플레이 |
| 8 | Top 리스크 | 조작감이 기대에 미치지 못함 |
| 9 | 완화/실험 | NES 테트리스 프레임 테이블 참조하여 정확한 속도 구현 |
| 10 | 다음 단계 | API 계약 정의 및 테스트 케이스 작성 |

---

## 1. 전체 사용자 여정 (Overview)

```mermaid
graph TD
    A[URL 접속] --> B[타이틀 화면]
    B --> C{플레이어 선택}
    C -->|PRESS START| D[게임 시작]

    D --> E[FEAT-1: 테트리스 플레이]
    E --> F{게임 오버?}

    F -->|No| G[계속 플레이]
    G --> E

    F -->|Yes| H[GAME OVER 화면]
    H --> I{하이스코어?}

    I -->|Yes| J[FEAT-4: 점수 저장]
    I -->|No| K[점수 표시]

    J --> K
    K --> L{재시작?}

    L -->|Yes| D
    L -->|No| B
```

---

## 2. FEAT-0: 게임 진입 플로우

```mermaid
graph TD
    A[URL 접속] --> B[리소스 로딩]
    B --> C{로딩 완료?}

    C -->|No| D[로딩 화면]
    D --> B

    C -->|Yes| E[타이틀 화면 표시]
    E --> F[BGM 시작 버튼 표시]

    F --> G{BGM 활성화?}
    G -->|Yes| H[코로베이니키 재생]
    G -->|No| I[음소거 상태]

    H --> J[PRESS START 대기]
    I --> J

    J --> K{입력 감지?}
    K -->|Space/Enter/Tap| L[게임 시작]
    K -->|설정| M[설정 화면]

    M --> N[음량/조작 설정]
    N --> J

    L --> O[게임 씬 전환]
```

---

## 3. FEAT-1: 테트리스 기본 플레이 플로우

```mermaid
graph TD
    A[게임 시작] --> B[보드 초기화]
    B --> C[첫 테트로미노 생성]

    C --> D[테트로미노 낙하]
    D --> E{입력 감지?}

    %% 조작 분기
    E -->|좌/우| F[수평 이동]
    E -->|회전| G[회전 처리]
    E -->|소프트 드롭| H[가속 낙하]
    E -->|하드 드롭| I[즉시 착지]
    E -->|일시정지| J[PAUSE]
    E -->|없음| K[자동 낙하]

    F --> L{충돌?}
    G --> L
    H --> L

    L -->|No| D
    L -->|Yes| M[원위치]
    M --> D

    I --> N[착지]
    K --> O{착지?}

    O -->|No| D
    O -->|Yes| N

    N --> P[라인 체크]
    P --> Q{완성 라인?}

    Q -->|Yes| R[FEAT-2: 라인 클리어]
    Q -->|No| S[다음 테트로미노]

    R --> S
    S --> T{게임 오버?}

    T -->|No| D
    T -->|Yes| U[GAME OVER]

    J --> V{재개?}
    V -->|Yes| D
    V -->|No| W[메인 메뉴]
```

---

## 4. FEAT-2: 스테이지/레벨 시스템 플로우

```mermaid
graph TD
    A[라인 클리어] --> B[클리어 라인 수 계산]
    B --> C[점수 계산]

    C --> D{1줄?}
    D -->|Yes| E[40 × (level+1)]

    D -->|No| F{2줄?}
    F -->|Yes| G[100 × (level+1)]

    F -->|No| H{3줄?}
    H -->|Yes| I[300 × (level+1)]

    H -->|No| J[4줄 테트리스!]
    J --> K[1200 × (level+1)]

    E --> L[총 라인 수 업데이트]
    G --> L
    I --> L
    K --> L

    L --> M{레벨업 조건?}
    M -->|10라인마다| N[레벨 증가]
    M -->|No| O[UI 업데이트]

    N --> P{레벨 10 도달?}
    P -->|Yes| Q[최고 레벨 유지]
    P -->|No| R[속도 증가]

    Q --> O
    R --> O

    O --> S[라인 클리어 애니메이션]
    S --> T[FEAT-3: 효과음 재생]
    T --> U[게임 계속]
```

---

## 5. FEAT-3: 오디오 시스템 플로우

```mermaid
graph TD
    A[오디오 이벤트] --> B{이벤트 유형?}

    B -->|게임 시작| C[BGM 재생]
    B -->|블록 이동| D[이동 효과음]
    B -->|블록 회전| E[회전 효과음]
    B -->|착지| F[착지 효과음]
    B -->|라인 클리어| G{몇 줄?}
    B -->|레벨업| H[레벨업 효과음]
    B -->|게임 오버| I[게임 오버 음악]
    B -->|일시정지| J[BGM 일시정지]

    G -->|1-3줄| K[클리어 효과음]
    G -->|4줄| L[테트리스 효과음]

    C --> M{음소거?}
    D --> M
    E --> M
    F --> M
    K --> M
    L --> M
    H --> M
    I --> M
    J --> N[BGM 페이드]

    M -->|Yes| O[재생 안함]
    M -->|No| P[재생]

    N --> Q[일시정지 상태]
```

---

## 6. FEAT-4: 점수 저장/조회 플로우

```mermaid
graph TD
    A[게임 오버] --> B[최종 점수 계산]
    B --> C[로컬 하이스코어 확인]

    C --> D{신기록?}
    D -->|No| E[기존 점수 표시]
    D -->|Yes| F[NEW HIGH SCORE!]

    F --> G[로컬 저장]
    G --> H{서버 저장?}

    H -->|Yes| I[API 호출: POST /scores]
    H -->|No| J[로컬만 저장]

    I --> K{성공?}
    K -->|Yes| L[저장 완료]
    K -->|No| M[재시도/로컬 저장]

    L --> N[랭킹 조회]
    M --> N
    J --> N
    E --> N

    N --> O[API 호출: GET /scores]
    O --> P{성공?}

    P -->|Yes| Q[랭킹 표시]
    P -->|No| R[로컬 랭킹만 표시]

    Q --> S[게임 오버 화면]
    R --> S

    S --> T{재시작?}
    T -->|Yes| U[새 게임]
    T -->|No| V[타이틀로]
```

---

## 7. 에러 처리 플로우

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형?}

    B -->|네트워크| C[점수 저장 실패]
    B -->|리소스 로딩| D[에셋 로드 실패]
    B -->|오디오| E[사운드 재생 실패]

    C --> F[로컬 저장으로 폴백]
    F --> G[재시도 버튼 표시]
    G --> H{재시도?}
    H -->|Yes| I[서버 저장 재시도]
    H -->|No| J[게임 계속]

    D --> K[기본 에셋 사용]
    K --> L[경고 메시지 표시]
    L --> J

    E --> M[음소거 상태로 전환]
    M --> N[음소거 알림]
    N --> J

    I --> O{성공?}
    O -->|Yes| J
    O -->|No| F
```

---

## 8. 리텐션 루프 (습관 형성)

```mermaid
graph TD
    A[게임 오버] --> B[점수 피드백]
    B --> C{신기록?}

    C -->|Yes| D[축하 애니메이션]
    C -->|No| E[이전 기록과 비교]

    D --> F[다음 목표 제시]
    E --> F

    F --> G[재도전 유도]
    G --> H{재시작?}

    H -->|Yes| I[즉시 재시작]
    I --> J[새 게임 시작]

    H -->|No| K[타이틀 화면]
    K --> L[하이스코어 표시]
    L --> M[PRESS START 대기]
    M --> N{재방문?}
    N -->|Yes| J
```

---

## 9. 화면 목록 (Screen Inventory)

| 화면 ID | 화면명 | FEAT | 진입점 | 주요 액션 |
|---------|--------|------|--------|----------|
| S-01 | 로딩 화면 | - | URL 접속 | 리소스 로딩 |
| S-02 | 타이틀 화면 | FEAT-0 | S-01 완료 | START, 설정 |
| S-03 | 설정 화면 | - | S-02 | 음량, 조작 설정 |
| S-04 | 게임 화면 | FEAT-1,2,3 | S-02 START | 테트리스 플레이 |
| S-05 | 일시정지 화면 | - | S-04 PAUSE | 재개, 종료 |
| S-06 | 게임 오버 화면 | FEAT-4 | S-04 게임오버 | 점수, 랭킹, 재시작 |

---

## 10. 화면 레이아웃

### S-04: 게임 화면 레이아웃

```
┌────────────────────────────────────────────────┐
│  SCORE: 012500    LEVEL: 05    LINES: 045     │
├────────────────────────────────────────────────┤
│                                                │
│   ┌──────────┐          ┌──────────┐          │
│   │          │          │  NEXT    │          │
│   │          │          │  ┌────┐  │          │
│   │          │          │  │    │  │          │
│   │  BOARD   │          │  └────┘  │          │
│   │  10×20   │          └──────────┘          │
│   │          │                                │
│   │          │          ┌──────────┐          │
│   │          │          │  HOLD    │          │
│   │          │          │  (v2)    │          │
│   │          │          └──────────┘          │
│   │          │                                │
│   └──────────┘                                │
│                                                │
├────────────────────────────────────────────────┤
│  [PAUSE]                        [RESTART]      │  (모바일)
│  [◀][▼][▶]                     [↻]            │  (터치 컨트롤)
└────────────────────────────────────────────────┘
```

---

## Decision Log 참조

| ID | 항목 | 선택 | 근거 |
|----|------|------|------|
| D-09 | 초기 진입 | 로그인 없이 바로 플레이 | 빠른 접근이 핵심 |
| D-10 | 점수 저장 | 익명 UUID 기반 | 개인정보 최소화 |
| D-11 | 오디오 시작 | 사용자 인터랙션 후 재생 | 브라우저 자동재생 정책 |
